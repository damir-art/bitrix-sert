# Авторизация
Авторизация на сайте, вход в админку.

- открываем тестовую страницу
- изменить страницу
- компонент авторизации: `Служебные > Пользователь > Форма авторизации`
  - сохранить

Создадим страницы авторизации:
- Создадим раздел `/user/`
- Страница регистрации: `/user/registration.php`
  - размещаем на странице компонент: `Служебные > Пользователь > Настраиваемая регистрация`
  - сохранить
- Страница профиля: `/user/profile.php`
  - размещаем на странице компонент: `Служебные > Пользователь > Параметры пользователя`
  - сохранить
- Страница забытого пароля:

На тестовой странице в параметрах компонента настариваем ссылки на созданные страницы:
- Страница регистрации: /user/registration.php
- Страница забытого пароля: /user/
- Страница профиля: /user/profile.php
- Сохранить

Открываем файл: `/user/index.php`, размещаем в ней код:

    <?php
    define("NEED_AUTH", true); // Определяем константу NEED_AUTH
    require($_SERVER["DOCUMENT_ROOT"] . "/bitrix/header.php");
    if (isset($_REQUEST["backurl"]) && strlen($_REQUEST["backurl"]) > 0)
      LocalRedirect($backurl);
    $APPLICATION->SetTitle("Авторизация");
    ?>
    <p>
      Вы зарегистрированы и успешно авторизовались.</p>
    <p>
      <a href="<?=SITE_DIR?>">Вернуться на главную страницу</a></p>

    <?php
    require($_SERVER["DOCUMENT_ROOT"] . "/bitrix/footer.php");?>

    <!--
    NEED_AUTH - в случае не авторизованного пользователя подключает компонент авторизации,
      если пользователь авторизован, то выводится сообщение об успешной авторизации
    Если на эту страницу будут передаваться определённые параметры в GET, то могут появиться
      страницы регистрации или восстановления пароля.
    -->

Выходим из админки, заходим на страницу с компонентом авторизации `/test.php`. Проверяем ссылки регистрации или восстановления пароля.

## Вёрстка
В шаблоне хранятся две формы, форма не для авторизованного пользователя и форма для авторизованного пользователя.

Форма аторизации:
- Копируем шаблон компонента авторизации в шаблон сайта .default
  - Компонент авторизации находится на странице `/test.php`
  - Шаблон назовём `auth`
  - Путь до шаблона: `/local/templates/.default/components/bitrix/system.auth.form/auth`
- После первой строки пролога, вставляем верстку авторизации
- пишем dump($arResult) чтобы посмотреть параметры
  - выходим из админки `<?php dump($arResult, false, true); ?>`
  - важные параметры, которые используются в шаблоне:
    - `AUTH_REGISTER_URL`
    - `AUTH_FORGOT_PASSWORD_URL`
    - `AUTH_LOGIN_URL`

Разное из шаблона:
- `<?if($arResult["FORM_TYPE"] == "login"):?>` проверка на авторизованность
  - форма не авторизованного пользователя
- у формы атрибуты name method action передаются в компонент
- SECURE_AUT - информативный характер, выводит информацию о том что шифрование пароля
  - будет использоваться в данно авторизации, этот блок можно удалить
- STORE_PASSWORD - проверка на сохранение пароля

Форма аторизованного пользователя:
- Правильно формируем ссылку для выхода пользователя из админки
- необходимо использовать в параметре GET `logout`, отвечает за выход пользователя из системы

Разное из шаблона:
- GetCurPageParam() - функция позволяющая формировать страницу с GET параметрами

Размещаем вызов компонента в шаблоне сайта.

В profile.php располагается компонент профиля пользователя.
